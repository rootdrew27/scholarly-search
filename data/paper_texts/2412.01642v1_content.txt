SECTION: Electrostatic interactions in atomistic and machine-learned potentials for polar materials
Long-range electrostatic interactions critically affect polar materials. However, state-of-the-art atomistic potentials, such as neural networks or Gaussian approximation potentials employed in large-scale simulations, often neglect the role of these long-range electrostatic interactions.
This study introduces a novel model derived from first principles to evaluate the contribution of long-range electrostatic interactions to total energies, forces, and stresses. The model is designed to integrate seamlessly with existing short-range force fields without further first-principles calculations or retraining. The approach relies solely on physical observables, like the dielectric tensor and Born effective charges, that can be consistently calculated from first principles. We demonstrate that the model reproduces critical features, such as the LO-TO splitting and the long-wavelength phonon dispersions of polar materials, with benchmark results on the cubic phase of barium titanate (BaTiO3).

SECTION: Introduction
In polar materials, displacing an ion from equilibrium generates an electric dipole. The resulting electric field decays as the inverse of the cube of the distance and interacts with local dipoles generated by far-away ionic displacements.
While these long-range electrostatic interactions are screened in metals, and their role becomes relevant only when accounting for ionic dynamics, in the absence of electrons in the conduction band long-range electric fields survive down to zero frequency, thus playing a fundamental role in the phenomenology of insulators. This includes the splitting between longitudinal and transverse optical phonons at long wavelengths (LO-TO splitting), affecting in turn all thermodynamic properties related to phonon dispersions, such as thermal expansion, heat capacity, lattice thermal conductivity, and Raman and IR spectra.
First-principles simulations include long-range electrostatic interactionswhen considering perturbations of finite wavevector, where the phonons can be evaluated either by finite-differencesor density-functional perturbation theory (DFPT). At(), the contribution of electrostatic interaction is nonanalytic, asperiodic displacements produce macroscopic polarizations resulting in a dynamical matrix for phonons dependent on the direction of thevector as it approaches.
This nonanalytic behavior of lattice force constants nearconstitutes a challenge in modeling efficient force fields for polar materials, as it originates from the cubic power-law decay of electrostatic forces and can not be captured if the interaction is truncated over a finite distance.

Thanks to the advances in machine learning technologies, many excellent tools to fit atomistic potentials from small sets of high qualityab initiocalculations have emerged, paving the way to the simulation of large-scale materials with hundreds of millions of atoms with an accuracy close to first principles methods.
However, the most commonly employed machine-learning potentials neglect the long-range electrostatic interactions, resulting in a smoothdependence of the atomic force constant matrix around. This is because the force field parametrizations account only for local atomic environments, and the first principles training data are evaluated on periodic boundary conditions that lack long-range contributions. The question arises of what should be fitted and how electrostatics can be recovered. Several methods have been developed to overcome this issue. Some approaches, the so-called second and third-generation machine-learning potential, split the energy expression into a short and long-range part, explicitly accounting for electrostatic interactions between point charges dependent on the local nuclear environment. These models suffer from the need for extra training data like partial atomic charges that, while easy to extract from DFT simulations, are not physical observables and ubiquitously defined. To overcome this issue, different methods have been proposed to rely on physical observables, like the electron densities, the Wannier functions, and polarization, which can be rigorously defined through the modern theory of polarization. These approaches have also been augmented to describe charge relocalization by solving a charge equilibration equation self-consistently, the so-called 4th generation scheme. While promising, these procedures require new first-principles calculations to store the extra information needed for the training, hampering the reuse of energy/forces data generated, for example, from previous first-principles calculations of molecular dynamics (FPMD).
A different strategy introduces long-range descriptors of atomic coordinates, also achieved by message-passing neural architectures architectures. While very promising, especially in their ability to account for macroscopic rearrangement of the electron charge in the system, these models need a training set with sufficiently large simulation cells to sample long-range interactions, preventing the employment of small simulation cells in the training data.

This work presents instead a comprehensive first-principles approach designed to integrate long-range interactions seamlessly with existing short-range force fields in polar condensed matter systems. The method accurately calculates total energies, forces, and stress tensors, and it is grounded solely on a select set of well-established first-principles properties of the material in its equilibrium state.

SECTION: Results
SECTION: Electrostatic energy
The coupling between dipoles is the leading term of the long-range electrostatic interactions in neutral systems. Each dipolegenerates an electric fielddecaying as the inverse of the cube of the distance, which interacts with other dipoles as

where bold symbols represent vectors and matrices; thein Eq. () prevents double counting when summing over all the atoms.

The overall dipole momentof the crystal can be rigorously defined through the modern theory of polarization. Here, we can define the atomic dipoleas the contribution to the overall dipole momentgiven by the displacement of atom

whereandare theCartesian component of the dipole moment per cell of the total system and the one of the-th atom, respectively.is the Born effective charges tensor,is the equilibrium position of the-th atom, andis the total dipole moment when atoms are in the equilibrium position, defined up to a quantum of polarization. We identify the atoms with Latin indices and the Cartesian components with Greek ones.
To parametrize the electric field generated by the dipoles of Eq. (), we define an auxiliary distribution of spherical charges reproducing a dipoleon each atom. In particular, each dipole consist of two chargesof opposite signs and at a distanceas

The modulus of the dipoleleaves an arbitrary choice on the values forand, which, however, only affects terms of the multipole expansions beyond the dipole and, thus, disappears from the final expression for the energy and its derivatives (forces and stresses) in the dipole limit (Appendix).

By exploiting this system of charges, we define a charge densitythat reproduces the correct long-range dipole-dipole interactions but sufficiently slow-varying to smear out short-range interactions.

whereis the position of the charge. We derive an expression forin Appendix.
Theparameter is the short-range smearing. This way, the resulting force field does not affect energies and its derivatives computed on periodic cells with a linear size smaller than.
This approach is highly practical as it enables adjustingin such a way that the charge density electrostatic interactions do not affect training data defined in small cells employed to develop the short-range machine-learning interatomic potential. Consequently, this makes the potential reusable in conjunction with our charge model, eliminating the need for retraining.

The electric field produced by a polar charge distribution, as in Eq. (), is slowly and conditionally convergent as it generates a macroscopic charge on the surface of the solid. The problem is solved in Fourier space with the Ewald summation for a 3D bulk material (details in Appendix):

whereis the supercell volume,is the imaginary unit coming from the Maxwell-Equations in Fourier space, andis the structure factor associated to the auxiliary charge system:

The values assumed by thevectors are constrained to be multiples of the reciprocal lattice:

where,, andare the reciprocal lattice vectors of the periodic supercell, andgo fromto, excluding. Additional care must be taken if the charge distribution is not defined in bulk systems, as in 2D materials or 1D chains, where Eq. () is no longer valid and a nonuniform spatial dependency of the dielectric tensor needs to be taken into account.

Integrating the electrostatic energy of Eq. () with the expression of the electric field (Eq.), we get the total energy (see Appendixfor details on the calculation)

Eq. () is the central result of this work. It defines the energy contribution of long-range dipole-dipole interactions and depends explicitly on the atomic positions. Notably, the expression for the energy only depends on physical observables, as the arbitrary (nonphysical) values of the atomic chargesand their positionscancel out in the dipole limit.
The computation of Eq. () requires first-principles quantities like the high-frequency dielectric tensorand effective chargesat the equilibrium position, and the only free parameter is the smearing factor.

SECTION: Forces and stress tensor
Long-range forces are obtained by deriving the expression for the electrostatic energy:

The only term that survives in the long-wavelength limit is the first one, as the second one goes asfor small values of. However, in the actual implementation, we kept the full expression Eq. () to guarantee that the numerical value of the forces coincides with the gradient of the total energy. The partition of the total dipole moment of the cell into local atomic dipoles operated in Eq. () violates the translational invariance of the system, introducing a nonzero net force in the center of mass.
However, the overall translational invariance can be easily restored directly in the total energy (Eq.) by redefining the centroidsas a function of the atomic positions to eliminate any rigid translation from the displacement(see Eq.).
In Appendix, we show how this choice restores the full translational invariance, correcting forces and stresses to satisfy the translational acoustic sum rule.

The stress tensorquantifies the energy to deform the lattice. Its computation is required in variable cell simulations, like NPT molecular dynamics or in the stochastic self-consistent harmonic approximation (SSCHA), and is fundamental in evaluating thermal expansion and the equation of state; it is defined

where the strain tensoris a symmetric matrix. Atomic positions (clamped ions) follow strain as

Since strain changes the lattice parameters, also the reciprocal vectorsare affected as

therefore, the scalar product betweenandremains unchanged under strain. The volume is also affected by the strain as

The expression of the stress can be easily obtained by substituting,,, andin the electrostatic energy (Eq.), and evaluating the Jacobian of Eq. () by applying the differential chain rule recursively.
Our implementation achieved the final result by exploiting the algorithmic differentiation as implemented in the Julia library ForwardDiff.jl.

SECTION: LO-TO splitting
One of the essential features that the long-range electrostatic force field must reproduce is the correct phonon dispersion in the long-wavelength limit, where, in bulk 3D material, the cubic decay of the dipole-dipole forces with the inverse of the distance gives rise to a discontinuity of the dynamical matrix at, where thelimit is dependent on the direction, and consequently to the LO-TO splitting (see ref.and ref.for the 2D and 1D case, respectively).
To prove that the model correctly reproduces the phonon dispersions in thelimit, we derived the expression of the interatomic force constant matrix

Restricting ourselves to the equilibrium position, the only surviving term is:

To highlight the long-wavelength limit, we perform the Fourier transform of

This equation is similar to theansatzemployed to perform the Fourier interpolation of phonons in first-principles codes like Quantum ESPRESSOor ABINITand reproduces the correctlimit when:

which coincides with the standard expression implemented in common electronic-structure packages for the non-analytic part of the force constant matrix (Eq. 18 of Ref.), after the conversion in CGS units where.
Eq. () demonstrates that the forces (Eq.) and energies (Eq.) parametrized by this model correctly reproduce the LO-TO splitting of any materials.

SECTION: Fitting the model
The model can be employed on top of any existing force field.
Its application requires the definition of an equilibrium structure where atoms are located in, and the dielectric tensorand the effective chargescomputed in this structure.
The equilibrium atomic positionsshould ideally correspond to a high symmetry phase, even if it is the saddle point of the energy landscape (with imaginary phonon frequencies). In this way, the energy and its derivatives satisfy all symmetry operations in subgroups of the parent one, thus enabling the potential to respect symmetry constraints of any subgroups. This is relevant in materials where temperature or pressure may change the crystallographic symmetry group by progressively increasing or decreasing the symmetries, like in perovskites, where the cubic Pmm group is a parent of all other symmetry-broken phases.
The model’s accuracy decreases as the structure deviates from the centroid one, particularly when the effective charges change significantly. However, in most polar crystals, effective charges are almost independent of the atomic positions as testified by the rarity of multi-phonon scattering modes observed in IR spectra experimentallyoriginated by the dependency of effective charges on the atomic position. This assumption breaks down when simulating liquids, materials where ions diffuse, or systems undergoing a significative rearrangement of chemical bonds (strongly first-order phase transitions). In the latter case, separate long-range models for each phase could be employed.

The only free parameter is the cutoff: the distance below which the long-range interactions are smeared out. The lower, the smaller the minimum distance between atoms interacting through dipole-dipole electrostatic, thus improving its accuracy. However, the computational cost to evaluate the energy and its derivative increases with low values ofas we need to include more-points in the summation of Eq. (). Also, ifis too small, higher orders of the multipole expansion, neglected by the polarization model, become important. Moreover, if the base short-range model has already been fitted, the long-range correction should not affect the training set. This sets a lower bound forto the maximum distance between any pair of atoms in the training data (accounting for PBC). Thus, the choice ofshould be a trade-off between computational cost, required accuracy, and the supercell dimension of the calculations in the training set.
Ifis smaller than the maximum distance between atoms in the training data, the long-range model energies (Eq.), forces (Eq.), and stresses alter the training values.
In this case, the long-range contribution to the total energy (and derivatives), as evaluated by the model, must be removed from the training data, and the short-range force field must be retrained.

Once,,, andare established, the final total energy (and its derivatives) of any structure are obtained by adding the ones evaluated by the short-range force field with those of the model.

SECTION: Correcting phonon dispersions inBaTiO3
Force engines that neglect long-range electrostatic interactions fail to recover the LO-TO splitting near the center of the Brillouin zone, resulting in a crude approximation of phonon dispersions.
This is one of the most severe sources of error in short-range force fields when applied to polar materials.
We exemplify this issue in the instance of-BaTiO3 (cubic perovskite, five atoms in the primitive cell, crystallographic group 221,). Harmonic phonons of this system are characterized by two unstable (imaginary) harmonic phonons across the entire Brillouin zone, as this structure is stabilized by thermal fluctuations at high temperature.
In Fig., we report the phonons evaluated within a short-range Gaussian approximation potential (GAP) (Ref.) with and without the addition of the long-range forces (Eq.), with.
As a reference, we plot the first-principles phonon dispersions evaluated within DFPT (with the PBEsol exchange-correlation potential, more details on Appendix), using the same parameters employed to generate the training set of the GAP model.
While the GAP already delivers a good agreement with DFPT at the edge of the Brillouin zone, it fails whenapproaches, displaying a significative deviation for some bands already at the halfway point of the Brillouin zone. This is
also evident from the zoom-in of the density of states (DOS, right panel of Fig.), where a phonon band gap betweenandshould separate the highest phonon band from the rest of the phonon dispersions. The short-range GAP does not recover this separation due to merging the LO and TO phonon bands near. On the contrary, the long-range corrected force field qualitatively reproduces the phonon band gap, improving the agreement with DFPT. Another important deviation is observed in the cubic structure’s imaginary (unstable) modes. In the short-range model, there is an additional imaginary mode nearby, absent in both the long-range model and the DFPT dispersions.

The chosen value of() slightly modifies the phonon dispersion at the edge of the Brillouin zone, where the q points are commensurate with the 2x2x2 supercell employed in the training set of the GAP. If a larger supercell were employed in the training data, the long-range interactions would have significantly altered the phonon dispersion. In the latter case, the energy (and its derivatives) should have been pre-processed by removing the long-range contribution before the training.

SECTION: Discussion
This approach assumes that the dielectric tensor and effective charges are independent of atomic coordinates.
This approximation fails when the change in the atomic position breaks covalent bonds or atoms can freely diffuse.
Thus, the method is more suited to describe the thermodynamics of structures that keep the same bonding network and topology during the simulation. However, it can still be used to study complex first-order phase transitions when coupled, e.g., with the SSCHA. Within this framework, atoms fluctuate around their centroids, and it is possible to compare the free energies of phases with different bonding networks without breaking any covalent bonds in the simulation, as demonstrated for the study of the-Y phase transition in metal-halides perovskitesor the hydrogen high-pressure phase-diagram.

Overcoming the limitations arising from the model assumptions requires
the introduction of the atomic environment dependency on effective charges, dielectric tensors, and centroids.
Electric properties like the total polarization, effective charges, and the dielectric tensor are, in fact, routinely parametrized through equivariant machine learning approaches, and the centroid parameter can be rigorously defined through the total polarization and effective charges by inverting Eq. (). In this way, it is possible to replace in Eq. () the explicit dependency of the effective charges, centroids, and dielectric tensor on the atomic positions, similarly as it has been proposed in third and fourth-generation machine learning force fields.

We presented a model that can pave the way to a rigorous introduction of long-range electrostatic interaction relying only on physical observables, i.e., without requiring extracting empirical parameters like local atomic charges. This energy-forces-stress model can be combined with existing short-range atomistic potentials, like the GAP shown in Fig.,
to account for long-range electrostatic interactions and further improve their accuracy. The long-range part of energies and forces can be calculated efficiently within Eq. () and (), respectively, and added to the results of short-range models. At the same time, the electrostatic stress tensor is computed by employing the algorithmic differentiation with the procedure explained in Eq. (,,).
Only one free parameter needs to be tuned: the smearing, quantifying the minimum range of the electrostatic interactions.
The Born effective chargesand the dielectric tensorare evaluated from first-principles DFPT. The model can correctly account for LO-TO splitting and shines in condensed systems with fixed crystal structures, paving the way to the next-generation machine-learning force fields accounting for long-range electrostatic interactions.

SECTION: Code avability
The equations for energy and forces (Eq., Eq.) have been implemented in Python and Juliaas an open-source package and can be downloaded from. The stress tensor is evaluated by exploiting the algorithmic differentiation of energy, as implemented in ForwardDiff.jl. The code is distributed under the GPLv3 license. It operates as a force field calculator for the Atomic Simulation Environment(ASE).

SECTION: Data avability
All the data reported in this work, such as dynamical matrices, dielectric tensor, and Born effective charges ofBaTiO3 evaluated to produce Fig., are published in the Example folder of the source code GitHub repository.

SECTION: Acknowledgments
L. M. acknowledges the H2020 program from the European Union for the MSCA-IF grant 101018714. This work was supported by the Swiss National Supercomputing Centre (CSCS) grant under project ID s1192.

SECTION: Appendices
SECTION: Auxiliary system of charges
We need to define a system of charges that satisfy the local dipole moment defined through Eq. (). For this purpose, for each atom, we generate two charges of opposite sign and modulus, ad a distanceso that. The specific choice ofanddo not affect the electric field when, so we have an arbitrary choice for their value. Without loss of generality, we defineas the trace of effective charge of the atom

and the position of the positive and negative chargesandto align the center dipole moment in the middle of the atomic displacement:

SECTION: Electric field
The electric field generated by a charge distributionin a periodic system can be expressed more conveniently in Fourier space transforming the Maxwell relations:

whereis evaluated from the Fourier transform of Eq. ()

Here,is the volume of the simulation cell.can only assume values so that the integrated function is periodic in(reported in Eq.). Extending the integral over all the solid volume and dividing by the number of k-pointsused to sample the Brillouin zone, we can swap the integral and the summation

Exploiting Eq. (), one gets the electrostatic potential

and the electric field as

To return to real space, we perform the inverse Fourier transform summing over all thepoints, excluding the(), as that term is zero in neutral systems ():

The sum overgoes on all atoms in all the cells, whileonly runs on the cells (the k-points), and the order of the two series can be exchanged thanks to the exclusion of.
For convenience, we define the charge structure factor as

Sinceis invariant if we shift the atomic positionsby a lattice vector, the summation on the atomsin the supercell istimes the one evaluated in the primitive cell only (Eq. ()).
Thus, we get the expression of the electric field

that coincides with the one reported in the main text (Eq.).

SECTION: Expression of the energy
Thanks to Eq. () and (), it is possible to build a system of point charges whose positions depend on the atomic coordinatesand the equilibrium configuration.

Substituting the expression of the dipoles (Eq.) in the energy Eq. (), we get:

whereis theCartesian component of the electric field on the atom. Substituting the expression of the electric field obtained from the Ewald sum (Eq.) into Eq. (), we get

Sinceis small (constrained by the exponential, whereis large), we expand theup to the first order and get Eq. ():

As pointed out in the main text, the dependency fromdisappears when expanding the sinus up to the first order, removing any arbitrary choice of the charged system to represent the correct polarization.

SECTION: Acoustic sum rule
The forces equation (Eq.) violates the translational invariance.
While the acoustic sum rule in the effective charge prevents a rigid translation of the system from generating a finite dipole moment

it cannot prevent a global translation from affecting the atomic local dipole, resulting in a shift of energy and a nonzero net force on the center of mass.
To prevent this dependence of the local atomic dipole on global translations, we redefine the centroid positionto eliminate rigid shifts

With this redefinition, the overall energy function (Eq.) is invariant under global translations. Thus, its derivatives satisfy all the acoustic sum rules.
In particular, we show that the actual contribution of this redefinition of the centroid on the forces cancels the force on the center of mass present in Eq. ():

In the numerical implementation, this expression can be applieda posteriorito Eq. ().

Care must be taken also when computing the stress tensor. In our implementation, since the redefinition of(Eq.) occurs inside the function that computes the total energy (Eq.), the chain rule performed by the algorithmic differentiation automatically includes also the derivatives of the, thus correcting the ASR also for the stress.

SECTION: Details of the DFT calculation
For the calculation of the DFT phonon spectrum ofBaTiO3 cubic perovskite reported in Fig., as well as for evaluating the effective charges and dielectric tensor, we employed the suite Quantum ESPRESSOversion 7.0 within the PBEsol exchange-correlation potential approximation.
We used PAW and ultrasoft pseudopotentials from the SSSP library version 1.2.1-efficiency, with a cutoff for the wavefunction and density ofand, respectively.
We sampled the Brillouin zone for the electrons with an 8x8x8 k-mesh without offset.
The lattice parameter used for the simulation is.

SECTION: References