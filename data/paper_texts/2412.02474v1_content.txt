SECTION: F-SE-LSTM: A Time Series Anomaly Detection Method with Frequency Domain Information

With the development of society, time series anomaly detection plays an important role in network and IoT services.
However, most existing anomaly detection methods directly analyze time series in the time domain and cannot distinguish some relatively hidden anomaly sequences.
We attempt to analyze the impact of frequency on time series from a frequency domain perspective, thus proposing a new time series anomaly detection method called F-SE-LSTM.
This method utilizes two sliding windows and fast Fourier transform (FFT) to construct a frequency matrix.
Simultaneously, Squeeze-and-Excitation Networks (SENet) and Long Short-Term Memory (LSTM) are employed to extract frequency-related features within and between periods.
Through comparative experiments on multiple datasets such as Yahoo Webscope S5 and Numenta Anomaly Benchmark, the results demonstrate that the frequency matrix constructed by F-SE-LSTM exhibits better discriminative ability than ordinary time domain and frequency domain data.
Furthermore, F-SE-LSTM outperforms existing state-of-the-art deep learning anomaly detection methods in terms of anomaly detection capability and execution efficiency.

[address1]
organization=College of Cyber Security,
addressline=Jinan University,
city=Guangzhou,
postcode=510632,
state=Guangdong,
country=China

[address2]
organization=Intelligent Science Department,
addressline=Xi’an Jiaotong-Liverpool University,
city=Suzhou,
postcode=215123,
state=Jiangsu,
country=China

[address3]
organization=Institute of Industrial Internet and Internet of Things,
addressline=China Academy of Information and Communications Technology,
city=Beijing,
postcode=100191,
country=China

SECTION: 1Introduction

With the development of society, time series data closely related to people are generated in large quantities in various fields, such as:
network traffic data generated when surfing the Internet[1],
transaction data generated by online transactions with others[2],
bioelectric signal data displayed on the electrocardiogram[3],
flow data generated by traffic monitoring equipment[4]and sensor data generated by Internet of Things (IoT) devices[5], etc.
Fig.1shows two time series of network traffic data, which exhibit similar trends over time, and thus have the same intrinsic regularity.
However, in the event of an attack on the server, network intrusion, traffic congestion, or network equipment failure that poses a threat to network security, the inherent patterns in the time series of this network traffic will be disrupted, leading to the emergence of abnormal points or anomalous data trends.
Therefore, anomaly detection of time series plays an important role in reducing economic losses, maintaining network security and social stability.

The detection of outliers in time series data[6]has been a subject of research since the last century.
After years of development, various methods based on statistical models suitable for anomaly detection have been explored in the field of time series analysis.
These methods include autoregressive (AR)[7], moving average (MA)[8], autoregressive moving average (ARMA)[9]and autoregressive integrated moving average (ARIMA)[10].
With the widespread adoption of machine learning and deep learning in artificial intelligence in recent years, many researchers have proposed novel time series anomaly detection methods based on these models.
These include techniques such as K-Means[11], local outlier factor[12], one-class support vector machines[13], convolutional neural network (CNN)[14]and recurrent neural network (RNN)[15], among others.

Since the time series statistical model is specially designed for time series data, the principle and structure of the model are relatively simple, and the applicable data types are limited.
Generally, time domain analysis can only be performed based on the original data of the time series.
In the time domain, although this method can quickly capture some obvious outliers, it is difficult to observe the differences in the time domain for some relatively similar sequences.
Therefore, we need to adjust the perspective and try to observe the time series from other domains.
As shown in Fig.2, sequence A and sequence B are very similar in time domain, and it is difficult to distinguish the difference between them, but in the frequency domain, the two sequences will have different amplitudes at certain frequencies, where these differences help to distinguish two time series that are very similar in the time domain.

Although machine learning and deep learning models are more complex, they can be used on a wide range of data types, including raw time series data and its derived features, such as statistical feature data and frequency domain data.
In addition, the parameters in the model can also be adaptively adjusted according to different data, so that the model can fully capture the characteristics of the data.
Therefore, time series anomaly detection methods based on machine learning or deep learning models can detect some relatively hidden anomalies, thereby obtaining more accurate anomaly detection results.

Only a few methods currently use frequency domain information in deep learning, and these methods only convert time series data directly into frequency domain data[16][17].
However, time series data typically changes over time and has temporal correlation in the time domain.
These methods directly convert time series into frequency data, which destroys the original temporal correlation information of the data and does not consider the frequency correlation in the same time period and between different time periods.

In this paper, we propose an anomaly detection method for time series based on frequency domain analysis and deep learning models, which combines fast Fourier transform (FFT)[18], Squeeze-and-Excitation networks (SENet)[19]and Long Short-Term Memory (LSTM)[20], called F-SE-LSTM.
FFT is a frequency domain transformation method that can efficiently convert time series with time domain data into frequency domain data.
Compared to other frequency domain transformation methods, FFT is more efficient and has a wide range of applications in signal processing, communication, and other fields.
SENet is a channel attention network based on CNN, and LSTM is a variant of RNN, which can avoid gradient disappearance and explosion during training for long sequences.
On the anomaly detection problem of time series, we first use FFT to convert time domain data of different time periods of time series into frequency domain data and construct a frequency matrix,
and then adopt SENet and LSTM to extract the frequency-related information within and between time periods,
and finally apply a deep neural network (DNN) to output binary classification results for anomaly detection.
We run experiments on some real datasets from Yahoo Webscope S5 and Numenta Anomaly Benchmark to verify the anomaly detection ability of the proposed method.
Experimental results on F1, recall and precision show that the proposed method shows excellent performance on these datasets, and its anomaly detection ability outperforms existing state-of-the-art methods.

The main contributions of this paper include the following three points:

Proposal of a method utilizing FFT and sliding window to transform time series data into a frequency matrix, which encompasses frequency-related features and frequency-based time-related features. This method offers valuable insights for the frequency domain analysis of time series data.

Integration of SENet and LSTM to construct time series anomaly detection models. This framework enables the extraction of frequency-related information within the same period and between different periods, enhancing the characterization of anomalies in time series data.

Experimental results demonstrate that our proposed method, F-SE-LSTM, outperforms existing anomaly detection methods in terms of detection capability and execution efficiency. This contribution presents a practical solution to the problem time series anomaly detection.

The remainder of this paper is organized as follows.
In Section 2, we review various time series anomaly detection methods, analyze their strengths and weaknesses, and then lead to the proposed anomaly detection method.
In Section 3, we describe our proposed F-SE-LSTM method in detail.
In Section 4, we describe the experimental procedure and provide a comprehensive comparison of our method with other methods.
Finally, we conclude this paper with a final section.

SECTION: 2Related work

With the development of science and technology, machine learning and deep learning models play an increasingly important role in many applications, especially in the field of artificial intelligence and have achieved good application results.
In the field of time series, machine learning and deep learning models can also better fit the characteristics of time series.
Therefore, many researchers have gradually applied machine learning and deep learning models to time series anomaly detection.
Up to now, many time series anomaly detection methods based on machine learning and deep learning models have been explored.
We summarize these methods into methods based on machine learning models, methods based on convolutional neural networks, methods based on recurrent neural networks, and methods based on various deep learning models according to the different algorithms used.
These methods are summarized below and their advantages and disadvantages are analyzed.

Methods based on machine learning models.
This method mainly uses machine learning models and some feature extraction algorithms to construct a time series anomaly detection method.
For example, Anton et al.[21]preprocess temporal data of network traffic time series using principal component analysis and detect anomalies using SVM and random forest classifiers to address network intrusion.
Experiments have verified that the above two machine learning models have good effects in industrial Internet applications on two network attack datasets in industrial environments.
To make up for the lack of a single model, Zhou et al.[22]fused k-nearest neighbor, symbolic aggregation approximation, and Markov model into one fusion model, and proposed an anomaly detection method called KSM.
This method mainly performs time domain analysis on the time series data in order to extract the features of amplitude variation and sequence shape, which can detect anomalies caused by shape and amplitude variation more accurately.
This method has higher data anomaly identification ability than most single methods.
In addition, some researchers have adopted the method of frequency domain spatial embedding to convert time series time domain data into frequency domain data, construct frequency domain features and then use machine learning models for detection.
For example, He and Pi[23]used short-time Fourier transform (STFT) to transform time series time domain data into frequency domain data, and then implemented early warning and detection of helicopter rotor failure using a one-class classification method based on support vector data description (SVDD).
Experiments show that the method can clearly detect the damage of helicopter rotor on the vibration data of a real helicopter.

Methods based on convolutional neural networks.
This method mainly uses convolutional neural network to construct time series anomaly detection method.
For example, Hwang et al.[24]proposed a malicious traffic detection mechanism D-PACK based on network traffic time domain data by combining CNN and Autoencoder.
This mechanism can only detect the first few bytes of the first few packets of each flow, which greatly reduces the data input, thereby improving the detection speed, and its accuracy is not much different from full detection, which can be better applied to industry.
Wen and Keyes[25]proposed a convolutional U-Net time series segmentation approach based on time series raw data for anomaly detection, which is the first time to use a CNN-based deep network for time series segmentation and shows better anomaly detection ability in time series.
In order to solve the network intrusion problem, Ullah and Mahmoud[26]constructed network traffic into one-dimensional, two-dimensional and three-dimensional data, and constructed CNN anomaly detection models including four convolution and pooling layers.
The experimental results show that the three CNN anomaly detection models are superior to other existing deep anomaly detection models.
Neupane et al.[27]built a Temporal Convolution Networks (TCN) based on CNN to detect abnormal vehicle sensor data.
Experimental results show that the model can achieve high anomaly detection accuracy.
Djamal et al.[28]used FFT to convert time domain data of the EEG time series into frequency domain data, and then used a CNN model to detect abnormal sequences.
Experiments show that FFT can greatly improve the accuracy of detecting time domain data, while CNN can extract appropriate frequency features, further improving the ability of anomaly detection.
Rahimi et al.[16]used FFT to extract acoustic emission signal features for detecting fuel tank leaks in cars, and used one-dimensional convolutional neural networks for detection.
Experiments show that using FFT for feature extraction is more effective and can achieve better detection results compared to wavelet transform and time-domain statistical features.

Methods based on recurrent neural networks.
This method mainly adopts recurrent neural network or its variants to construct time series anomaly detection method.
For example, Zhang and Zou[29]used an LSTM neural network model to predict sequences from light curve data and output prediction errors for anomaly detection.
Experimental results show that the model has good application effects in light curve time series prediction and anomaly detection.
To address the problem of anomaly detection in time series, Malhotra et al.[30]used stacked LSTM networks to forecast time series and detect anomalous sequence through prediction errors.
The model has produced promising results on many different types of real-world datasets, and also verified that the LSTM-based model outperforms the RNN-based model in time series anomaly detection.
For some unpredictable time series, they proposed an LSTM-based Encoder-Decoder model to reconstruct time series and detect abnormal sequences through the reconstruction error[31].
Experimental results show that the model can detect some unpredictable abnormal sequences, reflecting the robustness of the model.
Wang et al.[32]improved LSTM to predict time series data in rail transit systems and detect abnormal data based on prediction errors.
A large number of experiments have been carried out in the real subway operation environment to verify the effectiveness of the proposed scheme, and at the same time, it has better performance than the existing anomaly detection methods.
Kieu et al.[33]proposed two ensemble frameworks for time series anomaly detection based on recurrent autoencoders, one weight-independent and the other weight-shared.
Both frameworks use sparsely connected recurrent neural networks to build autoencoders, which can reduce the impact of autoencoders on outlier overfitting, thereby improving the overall detection performance.
In detecting abnormal traffic in Border Gateway Protocol (BGP), Cheng et al.[34]proposed a multi-scale LSTM model that can learn the long dependencies in temporal patterns of time domain data.
Experimental results on real BGP datasets show that the model is about 10% more accurate than LSTM and common machine learning models.
To detect various violent activities, Park et al.[35]used FFT to convert the accelerometer and gyroscope time series data into frequency domain data to analyze the frequency characteristics, and then used the LSTM model to classify punches, which can effectively detect violent activities and quickly respond to violent crimes.

Methods based on various deep learning models.
This method uses a variety of existing neural networks to construct a time series anomaly detection method.
For example, Kim and Cho[36]adopted the C-LSTM model[37]proposed by Zhou et al. to detect anomalous network traffic.
The model combines CNN and LSTM, which can simultaneously extract spatial and temporal features of time series data, and has better anomaly detection ability than other machine learning and deep learning models.
Yin et al.[38]stacked multiple time series into a time series matrix.
At the same time, referring to the C-LSTM model structure, they combined CNN and LSTM-based autoencoder to construct a C-LSTM-AE model suitable for time series matrices.
The model can well extract the time-related features generated by the time series matrix, and achieve better detection performance than C-LSTM on the network traffic dataset.

Among these time series anomaly detection methods, although the machine learning method can effectively detect the anomaly of time series data, this method simply regards the time series as a vector in a multidimensional space without considering the relationship between each data point.
Therefore, it is difficult to extract the deep features of time series.
The deep learning method can focus on the association between data points and can better extract the characteristics of time series.
For example, the convolutional neural network can extract the spatial correlation features of the time series, and the recurrent neural network can extract the temporal correlation features.
In addition, a small number of researchers use the frequency domain space embedding method to convert time series time domain data into frequency domain vectors, construct features that cannot be expressed in time domain space, and combine deep learning models to more fully capture the characteristics of time series.
However, most of the existing frequency domain methods only use frequency-related features without considering the correlation frequency features and time, and do not fully play their corresponding roles according to the characteristics of various deep learning models.
Therefore, these frequency domain methods also have a lot of room for improvement in the anomaly detection ability of time series.
To this end, we use FFT to convert time series of different time periods into frequency bands to construct frequency information containing time order, and use appropriate deep learning models to fully extract frequency-related features containing the time information, thereby constructing a more accurate and effective time series anomaly detection method.

SECTION: 3Methodology

In order to detect hidden abnormal data more accurately, and improve the anomaly detection ability of time series, a time series anomaly detection method F-SE-LSTM based on frequency domain is proposed,
which includes the following steps: (1) Construct frequency matrix data by FFT; (2) Extract features of frequency matrix by using SENet and LSTM; (3) Output anomaly detection results by DNN.
Below we first describe the steps to create the frequency matrix, then describe the construction of the anomaly detection model, and finally describe the parameter settings of the proposed method.

SECTION: 3.1Creation of frequency matrix

Consider a time seriesof length, as shown in Fig.3(a), the time seriesis divided intosequences of lengththrough the sliding window, namely

where, and each sequence represents each sample.
Each sample in the dataset that contains an outlier is considered an abnormal sample, and a sample that does not contain an outlier is considered a normal sample.
In order to make full use of the temporal correlation information of the samples and distinguish the normal samples and abnormal samples as accurately as possible, as shown in Fig.3(b), we continue to divide the samples of lengthintosubsequences of lengththrough another sliding window, and finally each sample is converted into a time series matrix:

where.

To find the abnormal samples that are difficult to identify in the time domain, we transform the time series matrix into other domains to construct relevant features.
The Fourier series is a special triangular series that can approximately represent any periodic function that meets the Dirichlet Conditions, which provides the basis for transformations to other domains.
In general, we discuss the Fourier series in the complex domain by introducing Euler’s formula, as in the following equation:

whereis time,is frequency, andis an imaginary unit.
In order to transform the function from time domain space to frequency domain space and expand it to non periodic function, Fourier transform (FT) was developed.
FT can directly realize the transformation of the signal from the time domain space to the frequency domain space by the following equation:

whereis angular frequency,is frequency domain function, which plays a key role in the field of signal processing.

Due to the inability to obtain continuous signals in practical applications, signals can only be sampled at certain time intervals.
To describe the frequency domain of discrete sequence data, we introduce the discrete Fourier Transform (DFT):

where the inputis the time domain data, and the outputis the frequency domain data of the complex plane.
It is necessary to take the modulus of the complex numberto obtain the frequency amplitudefor facilitating subsequent calculation:

When calculating Eqn. (5), FFT can divide the timein the equation into odd and even numbers and add them separately.
The idea of divide and conquer reduces the number of operations and greatly improves the operation efficiency of DFT operations.
In order to construct the relevant features in the frequency domain space, as shown in Fig.3(c), each sequence in the time series matrix is converted into frequency band amplitudes by using FFT, and the frequency matrix is further constructed.
Since the amplitudes of frequencyandare equal according to the Eqn. (5) and (6), onlyfrequencies in thecontain useful information, so the frequency matrix is:

where.

SECTION: 3.2Deep anomaly detection model

Here, we introduce a deep learning model combining SENet and LSTM for anomaly detection.
SENet is a CNN with channel attention mechanism, which can improve accuracy by modeling the correlation between feature channels and strengthening important features.
It can extract not only the interdependence between image pixels, but also the interdependence between channels, and has higher feature extraction capabilities than CNN.
Therefore, SENet is suitable for extracting the dependencies between frequencies within a certain time period.
On the other hand, LSTM, as a variant of RNN[39], can well model the temporal context dependencies of long and short sequences, and thus can model the dependencies between frequencies of different periods.
Combining the above two neural network models can allow the detection algorithms to give full play to their respective advantages in time series anomaly detection, so as to build a more robust anomaly detection model.

For the constructed frequency matrix, as shown in Fig.4(a), SENet first convolves the adjacent frequencies in each time period to obtainfor extracting the dependencies between adjacent frequencies, whereis the frequency dimension size after convolution, andis the channel dimension size.
In Fig.4(b), the matrixof each channel inis squeezed to obtainfor extracting the dependency between channels by the following equation:

whereis the matrix of the channel dimension of the tensor.
Then according the compress and excitation mechanism, the correlation coefficient tensoris obtained by convolving the channels of.
Finally, each channel vectorinis operated withsuch as: